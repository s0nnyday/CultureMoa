<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="utf-8" />
  <link rel="icon" href="/favicon.ico" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="theme-color" content="#000000" />
  <title>main</title>
   <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Source+Sans+3&display=swap" rel="stylesheet">  
  <link href="https://fonts.googleapis.com/css2?family=Montserrat&family=Source+Sans+3&display=swap" rel="stylesheet">  
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR&family=Source+Sans+3&display=swap" rel="stylesheet">  <link href="https://webfontworld.github.io/gmarket/GmarketSans.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" th:href="@{/styles/freelist.css}"/>
  <link rel="stylesheet" th:href="@{/styles/main.css}"/>
  <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
<script>
	//gnb드롭다운
	 function showDropDown() {
         const gnbDropdown = document.getElementById('gnbDropdown');
         gnbDropdown.style.visibility = 'visible';
      }

     function hideDropDown() {
         const gnbDropdown = document.getElementById('gnbDropdown');
         gnbDropdown.style.visibility = 'hidden';
     }
     function cancelHide() {
         const gnbDropdown = document.getElementById('gnbDropdown');
         gnbDropdown.style.visibility = 'visible';
     }
     
	//오픈톡 띄우기
	function opentalk(){
		// 새 창을 띄우기 위한 옵션 설정
        var windowFeatures = 'width=550px,height=550px';
        // 새 창 열기
        var newWindow = window.open('/opentalk', '_blank', windowFeatures);
        // 새 창이 차단되었을 경우 알림
        if (!newWindow) {
            alert('팝업 차단 기능이 활성화되어 있습니다. 새 창이 열리지 않을 수 있습니다.');
        }
	}	
	
	//채팅 업데이트 함수
 	function checkNo(){
		var now=$("#now").val();
		$.ajax({
			url:"main_updateTalk",
			data:{now:now},
			success:function(data){
				if(data.length!=0){
					now = parseInt(now); // 
					now = now + data.length; // 50 + 1 = 51
					$("#now").val(now);
					for(var i=0;i<data.length;i++){
						var div=$("<div></div>").addClass("chat-SJD");
						var pro_div=$("<div></div>").addClass("profile-C2V");
						if(data[i].gender=="여성"){
							src="./assets/icon_여성.png";
						}else{
							src="./assets/icon_남성.png";
						}
						var img=$("<img></img>").addClass("ellipse-8-Y6M").attr("src",src);
						var img2=$("<img></img>").addClass("profile-seR").attr("src","./assets/iconprofile-m69.png");
						var id=$("<div></div>").addClass("name-DCV").html(data[i].id);
						pro_div.append(img).append(img2).append(id);
  						
  						var content_div=$("<div></div>").addClass("textcontent-ub7").html(data[i].talkcontent);

						div.append(pro_div).append(content_div);
						
						$(".inputchat-i7K").append(div);
					}
				}
				
			}
		});
	} 
	  
	// 1초마다 updateTalk 함수 호출
    setInterval(checkNo, 200);
	//----------------------------채팅입력 및 전송
	function insertTalk(){
		var talk = $("#myInput").val().replace(/\n/g, "<br>");
		var id=$("#id").val();
		console.log(id);
		if(!id){
			alert("로그인이 필요합니다");
		}else{
			$.ajax({
				url:"main_insertTalk",
				data:{talk:talk},
				success:function(){
					$("#myInput").val("");
				}
			});
		}
	}
	
	//-----------------------텍스트 창 스크롤이 항상 맨 밑에 위치
	// 스크롤 맨 아래로 이동하는 함수
	function scrollToBottom() {
	  const scrollableDiv = document.getElementById("scrollableDiv");
	  scrollableDiv.scrollTop = scrollableDiv.scrollHeight;
	}
	
	// DOM이 로드되면 스크롤 가능한 div가 맨 아래로 스크롤되도록 함수를 호출합니다.
	document.addEventListener("DOMContentLoaded", scrollToBottom);
	
	// 스크롤 이벤트를 감지하여 스크롤이 변경되어도 스크롤 가능한 div가 맨 아래에 위치하도록 함수를 호출합니다.
	document.getElementById("scrollableDiv").addEventListener("scroll", scrollToBottom);
	
	//--------------------엔터쳤을때 텍스트가 전송	
	var isShiftKeyPressed = false;
	
	function handleKeyDown(event) {
	  if (event.keyCode === 16) {
	    // Shift 키를 눌렀을 때 isShiftKeyPressed를 true로 설정합니다.
	    isShiftKeyPressed = true;
	  } else if (event.keyCode === 13) {
	    if (isShiftKeyPressed) {
	      // Shift 키를 누른 상태에서 Enter 키를 누르면 다음 줄로 이동합니다.
	      isShiftKeyPressed = false; // Shift 키 상태 초기화
	    } else {
	      // Shift 키를 누르지 않고 Enter 키를 누르면 insertTalk() 함수를 호출합니다.
	      insertTalk();
	      event.preventDefault(); // Enter 키의 기본 동작(새 줄 생성)을 방지합니다.
	    }
	  }
	}
	 
// JavaScript 코드 시작
  const slides = document.querySelectorAll('.bannersample03-Uhf'); // 슬라이드 요소들을 선택합니다.
  let currentSlide = 0;
  const slideInterval = 1000; // 슬라이드 간격 (3초)

  function showSlide(n) {
    slides.forEach((slide) => {
      slide.style.display = 'none'; // 모든 슬라이드를 숨깁니다.
    });
    slides[n].style.display = 'block'; // 현재 슬라이드를 보여줍니다.
  }

  function nextSlide() {
    currentSlide = (currentSlide + 1) % slides.length; // 다음 슬라이드 인덱스 계산
    showSlide(currentSlide);
  }

  function startSlideShow() {
    showSlide(currentSlide); // 페이지 로딩 시 첫 번째 슬라이드를 보여줍니다.
    setInterval(nextSlide, slideInterval); // 슬라이드 쇼를 자동으로 실행합니다.
  }

  startSlideShow(); // 슬라이드 쇼 시작	

</script>
</head>
<body>
<!--id  -->
<input type="hidden" id="id" th:value="${id}">
<!--now no -->
<input type="hidden" id="now" th:value="${now}">	
	
<div class="main-mVB">
  <!-- header -->
  <div class="auto-group-9o4m-KFo">
    <div class="header-Tcu">
      <p class="logo-mtV">
      컬쳐
      <br/>
      모아
      </p>
      <div class="searchbar-VZb">
        <div class="searchicon-pLy">
          <img class="iconsearch-vuo" src="./assets/iconsearch-uiy.png"/>
        </div>
        <div class="searchtext-qG5">검색어를 입력하세요.</div>
        <div class="divsearch-h3P">
        </div>
      </div>
      <div class="login-2LZ">로그인</div>
      <div class="signup-ijB">회원가입</div>
    </div>
    <!--gnb -->
    <div class="gnb-EhX" onmouseover="showDropDown()"  onmouseout="hideDropDown()">
      <div class="divintro-9pV" >소개</div>
      <div class="divevent-3Q5">행사소식</div>
      <div class="divcommunity-xG9">커뮤니티</div>
      <div class="divfaq-fwF">FAQ</div>
      <div class="divmypage-o1s">마이페이지</div>
      <div class="divopentalk-DLV">
        <img class="iconopentalk-vEu" src="./assets/iconopentalk-2m7.png"/>
        <div class="opentalk-GJm" onclick="opentalk()">오픈톡</div>
      </div>
      <div class="divmessage-aaM">
        <img class="iconmessage-VBX" src="./assets/iconmessage-2Bj.png"/>
        <div class="message-Rqs">쪽지</div>
      </div>
    </div>
  </div>
  
  <div class="auto-group-rgrf-WcR">
    <div class="main-Fpu">
	  <!-- 메인배너 -->
      <div class="banner-NuX">
        <div class="banner-slide-jEH">
          <div class="bannersample03-Uhf">
            <img class="imagebanner-Rso" src="./assets/imagebanner-bBF.png"/>
            <div class="banner-slide-ZUD">
              <div class="group-11-WPT">
                <div class="imagebanner-U5P" src="./assets/imagebanner-bBF.png"/>
                </div>
                <div class="banner-slide-aPK">
                  <div class="bannerslide-slide01-XZT">
                    <div class="rectangle-117-H2q">
                      <img class="imagebanner-dMb" src="./assets/imagebanner-jiq.png"/>
                      <div class="btnslide-mih">
                        <img class="btnprevious-smj" src="./assets/btnprevious-xdo.png"/>
                        <div class="nn-nn-pS5">nn/nn</div>
                        <img class="btnnext-wFo" src="./assets/btnnext-GD7.png"/>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <!--주요 서비스 -->
      <div class="auto-group-ejdf-2Y9">
        <div class="service-XUu">
          <div class="auto-group-qtm3-qEh">
            <div class="servicetitle-Y97">주요서비스</div>
            <div class="servicesubtitle-Qh7">문화포털의 주요서비스를 바로 만나보세요!</div>
          </div>
          <div class="servicelist-649">
            <div class="siteintro-Ccy">
              <div class="icon01-jN1">
                <img class="item--sj7" src="./assets/-6CZ.png"/>
              </div>
              <div class="item--ZM3">사이트 소개</div>
            </div>
            <div class="event-FzZ">
              <div class="icon02-c4R">
                <img class="item--wcV" src="./assets/-4Fj.png"/>
              </div>
              <div class="item--FNH">국내 공연</div>
            </div>
            <div class="eventreview-xnV">
              <div class="icon03-7QV">
                <img class="item--4ad" src="./assets/-ukV.png"/>
              </div>
              <div class="item--Adf">공연 후기</div>
            </div>
            <div class="faq-GRo">
              <div class="icon04-2A5">
                <img class="faq-PFX" src="./assets/faq.png"/>
              </div>
              <div class="faq-ujf">FAQ</div>
            </div>
            <div class="freeboard-3ay">
              <div class="icon05-Peq">
                <img class="open-talk-9tu" src="./assets/open-talk.png"/>
              </div>
              <div class="item--5Xf">자유게시판</div>
            </div>
          </div>
        </div>
        <!-- 주변 행사 소식-->
        <div class="news-z8q">
          <div class="auto-group-9job-9Gd">
            <div class="newstitle-siR">주변 행사 소식</div>
            <div class="dropdownarea-oMB">
              <div class="component-20-MtV">
                <div class="auto-group-rq2q-7cm">
                  <div class="selectarea-GEm">지역을 선택하세요.</div>
                  <img class="vector-1-PaH" src="./assets/vector-1-GTB.png"/>
                </div>
                <div class="line-3-isT">
                </div>
              </div>
            </div>
          </div>
          <div class="auto-group-zqav-fXo">
            <div class="btnslide2-RWy">
              <img class="newsbtnprevious-m53" src="./assets/newsbtnprevious-i8y.png"/>
              <img class="newsbtnnext-gSu" src="./assets/newsbtnnext-cyP.png"/>
            </div>
            <div class="poster-Qth">
              <div class="poster-kSm">
                <div class="imgposter-VfF">
                </div>
                <div class="frame-6-aaD">
                  <div class="frame-3-jT7">공연 종류</div>
                  <div class="eventname-2BK">공연 이름</div>
                </div>
              </div>
              <div class="poster-m8u">
                <div class="imgposter-j5j">
                </div>
                <div class="frame-6-p7B">
                  <div class="frame-3-mYD">공연 종류</div>
                  <div class="eventname-rZf">공연 이름</div>
                </div>
              </div>
              <div class="poster-Brq">
                <div class="imgposter-9of">
                </div>
                <div class="frame-6-rCH">
                  <div class="frame-3-bvZ">공연 종류</div>
                  <div class="eventname-hih">공연 이름</div>
                </div>
              </div>
              <div class="poster-dsF">
                <div class="imgposter-zxh">
                </div>
                <div class="frame-6-uZs">
                  <div class="frame-3-GQR">공연 종류</div>
                  <div class="eventname-ZeR">공연 이름</div>
                </div>
              </div>
              <div class="poster-6eM">
                <div class="imgposter-4bB">
                </div>
                <div class="frame-6-xwT">
                  <div class="frame-3-vdP">공연 종류</div>
                  <div class="eventname-C57">공연 이름</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="calendar-iJM">
        <div class="divtoggle-2pq">
          <div class="toggle-9eZ">
            <div class="toggle02-JnM">공연일정</div>
            <div class="toggle01-keM">티켓 오픈 일정</div>
          </div>
        </div>
        <div class="positioncalendar-di9">
        </div>
      </div>
      <!-- 오픈톡 -->
      <div class="opentalk-m3f">
	    <!-- 오픈톡 타이틀-->
        <div class="opentalktitle-gRX">오픈톡</div>
        <!-- 오픈톡 프레임 -->
        <div class="divchat-BNH" id="scrollableDiv">
		 <!-- 채팅창 -->
          <div class="inputchat-i7K">
			  
			<!--talk1 -->
            <div class="chat-SJD"  th:each="t:${talk}">
			  <!--talk icon-->	
              <div class="profile-C2V">
                <img class="ellipse-8-Y6M" th:src="@{'./assets/icon_' + (${t.gender} eq '여성' ? '여성' : '남성') + '.png'}"/>
                <img class="profile-seR" src="./assets/profile-12Z.png"/>
                <!--talk 아이디 -->
                <div class="name-DCV" th:text="${t.id != null ? t.id : 'Unknown'}"></div>
              </div>
              <!--talk 내용-->
              <div class="textcontent-ub7" th:utext="${t.talkcontent}"></div>
            </div>
            
          </div>
        </div>
        
        <!--채팅입력 -->
        <div class="inputtext-Dbo">
          <img class="profile-kbj" src="./assets/profile-kVw.png"/>
          <div class="text-swF">
			   <!--채팅 입력 -->
   			   <textarea id="myInput" placeholder="내용을 입력하세요" onkeydown="handleKeyDown(event)"></textarea>
		  </div>
		  <!--전송 버튼 -->
		  <button class="insertBtn" onclick="insertTalk()">전송 </button>
		  
        </div>
      </div>
      <!-- 게시판 -->
      <div class="board-7qb">
        <div class="auto-group-qosq-eKj">
          <div class="boardtitle-NWd">게시판</div>
          <div class="boardth-gGR">
            <div class="boardtitle-Rzh">제목</div>
            <div class="boardregdate-xUq">게시일</div>
          </div>
        </div>
        <div class="auto-group-pu6z-srh">
          <div class="boardtable-ESM">
            <div class="boardlist-yeq">
              <div class="list-LkH">
                <div class="title-6zM">제목</div>
                <div class="regdate-S2d">YYYY-MM-DD</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!-- gnb 드롭다운-->
    <div class="gnbdrop-down-XJy"  style="visibility: hidden;" id="gnbDropdown"  onmouseover="cancelHide()" onmouseout="hideDropDown()">
      <div class="property-1default-DSh">
        <div class="pageinfo-mDK pointer">페이지소개</div>
        <div class="teaminfo-VQD pointer">팀원소개</div>
      </div>
      <div class="property-1default-czd">
        <div class="festival-mMj pointer">페스티벌</div>
        <div class="domestic-6Q1 pointer">국내공연</div>
        <div class="overseas-SCy pointer">내한공연</div>
        <div class="musical-Aem pointer">뮤지컬</div>
        <div class="localfestival-uMT pointer">지역축제</div>
      </div>
      <div class="property-1default-qW1">
        <div class="freelist-PGd pointer">자유게시판</div>
        <div class="reviewlist-KRB pointer">후기게시판</div>
        <div class="togetherlist-T1b pointer">동행게시판</div>
      </div>
      <div class="faq-BTP pointer">FAQ</div>
      <div class="property-1default-7M3">
        <div class="wishlist-GUq pointer">관심목록</div>
        <div class="message-1SR pointer">쪽지함</div>
        <div class="memberinfo-Yx9 pointer">회원정보</div>
      </div>
    </div>
  </div>
</div>
</body>