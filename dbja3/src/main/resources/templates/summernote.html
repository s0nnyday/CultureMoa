<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<!-- include libraries(jQuery, bootstrap) -->
<link href="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.css" rel="stylesheet">
<script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.js"></script>
<script src="http://netdna.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.js"></script>
<!-- include summernote css/js-->
<link href="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.css" rel="stylesheet">
<script src="http://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.2/summernote.js"></script>
<!-- include summernote-ko-KR -->
 <!-- 서머노트를 위해 추가해야할 부분 -->
 <link rel="stylesheet" href="/summernote/summernote-lite.css">
  <!--  -->
</head>
<script type="text/javascript">

  $(document).ready(function() {
	//여기 아래 부분
	$('#summernote').summernote({
				height: 300,                 // 에디터 높이
				minHeight: null,             // 최소 높이
				maxHeight: null,             // 최대 높이
				focus: true,                  // 에디터 로딩후 포커스를 맞출지 여부
				lang: "ko-KR",					// 한글 설정
				placeholder: '최대 2048자까지 쓸 수 있습니다',	//placeholder 설정
				callbacks: {	//여기 부분이 이미지를 첨부하는 부분
					onImageUpload : function(files) {
						//console.log(files)
						uploadSummernoteImageFile(files[0],this);
					},
					onPaste: function (e) {
						var clipboardData = e.originalEvent.clipboardData;
						if (clipboardData && clipboardData.items && clipboardData.items.length) {
							var item = clipboardData.items[0];
							if (item.kind === 'file' && item.type.indexOf('image/') !== -1) {
								e.preventDefault();
							}
						}
					}
				}
	});
	
});


	function uploadSummernoteImageFile(file, editor) {
		data = new FormData();
		data.append("file", file);
		$.ajax({
			data : data,
			type : "POST",
			url : "/uploadSummernoteImageFile",
			enctype: 'multipart/form-data',
			contentType : false,
			processData : false,
			success : function(response) {
				console.log(response);
				  // JSON 문자열을 JSON 객체로 파싱
	            var jsonResponse = JSON.parse(response);
				console.log(jsonResponse);
	            // url에 접근하여 이미지 삽입
	            $(editor).summernote('insertImage', jsonResponse.url);
            	//항상 업로드된 파일의 url이 있어야 한다.
				//$(editor).summernote('insertImage', response.url);
				//$(el).summernote('editor.insertImage', response.url);
				
			}
		});
	}
	$("div.note-editable").on('drop',function(e){
         for(i=0; i< e.originalEvent.dataTransfer.files.length; i++){
         	uploadSummernoteImageFile(e.originalEvent.dataTransfer.files[i],$("#summernote")[0]);
         }
        e.preventDefault();
   });
   function goWrite(frm) {
	var title = frm.reveiwtitle.value;
	var content = frm.reviewcontent.value;
	
	if (title.trim() == ''){
		alert("제목을 입력해주세요");
		return false;
	}
	if (content.trim() == ''){
		alert("내용을 입력해주세요");
		return false;
	}
	frm.submit();
}
   
</script>
<body>
	<form id="board" role="form" action="/board" method="post">
	  <h3 style="margin-bottom: 25px;">Article Form</h3>
	  <div class="form-group">
	    <input type="text" class="form-control" id="reviewtitle" name="reviewtitle" placeholder="subject" required>
	  </div>
	  <div class="form-group">
	    <textarea class="form-control" id="summernote" name="Contents" placeholder="reviewcontent" maxlength="140" rows="7"></textarea>
	  </div>
	  <button onclick="goWrite(this.form)" class="btn btn-primary pull-right">Submit Form</button>
	</form>

</body>
</html>